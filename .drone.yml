kind: pipeline
name: deploy

trigger:
  branch:
  - master

steps:
- name: submodules
  image: alpine/git
  commands:
  - git submodule init
  - git config 'submodule.themes/2019.url' 'http://git.chillidonut.com/grrowl/hugo-2019.git'
  - git submodule update --recursive --remote
- name: hugo
  image: monachus/hugo:v0.58.3
  commands:
  - hugo --gc --minify
- name: upload
  image: plugins/gcs
  settings:
    source: public/
    target: chillidonut.com/
    gzip: js,css,html
    cache_control: public,max-age=3600
    token:
      from_secret: deploy-token
